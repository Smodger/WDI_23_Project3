"use strict";function Router(e,t){e.state("challengesIndex",{url:"/challenges",templateUrl:"/templates/challengesIndex.html",controller:"ChallengesIndexController as challengesIndex"}).state("challengesNew",{url:"/challenges/new",templateUrl:"/templates/challengesNew.html",controller:"ChallengesNewController as challengesNew"}).state("challengesShow",{url:"/challenges/:id",templateUrl:"/templates/challengesShow.html",controller:"ChallengesShowController as challengesShow"}).state("challengesEdit",{url:"/challenges/:id/edit",templateUrl:"/templates/challengesEdit.html",controller:"ChallengesEditController as challengesEdit"}).state("register",{url:"/register",templateUrl:"/templates/register.html",controller:"RegisterController as register"}).state("registerInterim",{url:"/registerInterim",templateUrl:"/templates/registerInterim.html"}).state("confirm",{url:"/confirm/:confirmationCode",templateUrl:"/templates/confirm.html",controller:"ConfirmController as confirm"}).state("login",{url:"/login",templateUrl:"/templates/login.html",controller:"LoginController as login"}).state("home",{url:"/",templateUrl:"/templates/home.html"}).state("usersIndex",{url:"/challengers",templateUrl:"/templates/usersIndex.html",controller:"UsersIndexController as usersIndex"}).state("usersEdit",{url:"/challengers/:id/edit",templateUrl:"/templates/usersEdit.html",controller:"UsersEditController as usersEdit"}).state("usersShow",{url:"/challengers/:id",templateUrl:"/templates/usersShow.html",controller:"UsersShowController as usersShow"}).state("storiesIndex",{url:"/stories",templateUrl:"/templates/storyIndex.html",controller:"StoriesIndexController as storiesIndex"}).state("storiesCreate",{url:"/stories/new",templateUrl:"/templates/storyCreate.html",controller:"StoriesCreateController as storiesCreate"}).state("storiesCreateEntry",{url:"/stories/:id/newEntry",templateUrl:"/templates/storyCreateEntry.html",controller:"StoriesCreateEntryController as storiesCreateEntry"}).state("storiesEdit",{url:"/stories/entries/:id/",templateUrl:"/templates/storyEdit.html",controller:"StoriesEditController as storiesEdit"}).state("storiesShow",{url:"/stories/:id",templateUrl:"/templates/storyShow.html",controller:"StoriesShowController as storiesShow"}),t.otherwise("/challenges")}function Auth(e){e.facebook({clientId:"199317997186512"}),e.tokenPrefix="",e.loginUrl="/login",e.signupUrl="/register"}function RegisterController(e,t){function r(){e.signup(o.user).then(function(){t.go("registerInterim")})}var o=this;o.user={},o.submit=r}function ConfirmController(e,t){e({method:"POST",url:"/confirm/"+t.params.confirmationCode})}function LoginController(e,t,r,o){function l(){s.isLoggedIn=!0,console.log(s.isLoggedIn),e.login(s.credentials).then(function(){s.currentUser=e.getPayload(),s.currentUser&&r.get({id:s.currentUser._id},function(e){o.account=e,console.log(o.currentUser)}),t.go("home")})}function n(r){e.authenticate(r).then(function(){t.go("home")})}var s=this;s.credentials={},s.submit=l,s.authenticate=n}function Challenge(e){return new e("/challenges/:id",{id:"@_id"},{update:{method:"PUT"}})}function ChallengesIndexController(e){var t=this;t.all=e.query()}function ChallengesNewController(e,t,r){function o(){e.save(l.challenge,function(){t.go("challengesIndex")})}var l=this,n=r.getPayload();l.challenge={},l.challenge.projectCreator=[n._id],l.create=o}function ChallengesShowController(e,t,r,o){function l(){g.challenge.$remove(function(){r.go("challengesIndex")})}function n(){if(h){var e=g.challenge.like.indexOf(h._id);!g.challenge.like.includes(h._id)&&h._id?g.challenge.like.push(h._id):g.challenge.like.includes(h._id)&&h._id&&g.challenge.like.splice(e,1),g.challenge.$update()}else r.go("login")}function s(){var e=g.challenge.participants.findIndex(function(e){return h._id===e._id});e===-1&&(g.challenge.participants.push(g.userProfile),g.userProfile.activeChallenges.push(g.challenge._id),g.challenge.$update(),g.userProfile.$update())}function i(){var e=g.challenge.participants.findIndex(function(e){return h._id===e._id});g.challenge.participants.splice(e,1),g.userProfile.activeChallenges.splice(e,1),g.challenge.$update(),g.userProfile.$update()}function a(){h?g.popUpActive=!g.popUpActive:r.go("login")}function c(){g.challenge.comments.push(g.comment),g.challenge.$update(function(){g.comment=""})}function u(){if(h&&g.challenge)return g.challenge.participants.filter(function(e){return h._id===e._id}).length>0}var g=this,h=o.getPayload();h&&t.get({id:h._id},function(e){g.userProfile=e}),e.get(r.params).$promise.then(function(e){g.challenge=e}),g.payload=h,g.isSubscribed=u,g.addComment=c,g.togglePopUp=a,g.Unparticipate=i,g.participate=s,g.incrementLikes=n,g.isLoggedIn=o.isAuthenticated,g.deleteChallenge=l}function ChallengesEditController(e,t){function r(){o.challenge.$update(function(){t.go("challengesShow",t.params)})}var o=this;o.challenge=e.get(t.params),this.update=r}function currentUser(e,t){var r=this,o=t.getPayload();o&&e.get({id:o._id},function(e){r.account=e})}function StoryEntries(e){return new e("/stories/entries/:id",{id:"@_id"},{update:{method:"PUT"}})}function googleplace(e){return{restrict:"A",require:"ngModel",scope:{location:"="},link:function(t,r,o,l){var n={types:[],componentRestrictions:{}},s=new e.google.maps.places.Autocomplete(r[0],n);s.addListener("place_changed",function(){var e=s.getPlace();t.location=e.geometry.location.toJSON(),l.$setViewValue(r.val())})}}}function googleMap(e){return{restrict:"E",replace:!0,template:'<div class="google-map">Google Map HERE</div>',scope:{challenge:"="},link:function(t,r){t.$watch("challenge",function(){if(t.challenge){var o=new e.google.maps.Map(r[0],{center:t.challenge.location,zoom:6,scrollwheel:!1});new e.google.maps.Marker({position:t.challenge.location,map:o,animation:e.google.maps.Animation.DROP})}})}}}function MainController(e,t,r){function o(){console.log("in toggle menu"),n.menuActive=!n.menuActive,console.log(n.menuActive)}function l(t,o){n.message=null,!e.isAuthenticated()&&s.includes(o.name)&&(t.preventDefault(),r.go("login"),n.message="You must be logged in to go there!")}var n=this;n.isLoggedIn=e.isAuthenticated,n.currentUser=e.getPayload(),n.toggleMenu=o;var s=["challengesEdit","challengesNew"];t.$on("$stateChangeStart",l)}function ProfileController(e,t,r,o){function l(){e.logout().then(function(){n.account=null,t.go("home")})}var n=this;n.isLoggedIn=e.isAuthenticated,e.getPayload()&&(n.currentUserId=e.getPayload()._id),n.currentUser=o,n.isLoggedIn()&&r.get({id:n.currentUserId},function(e){o.account=e}),n.logout=l,n.message=null}function StoriesIndexController(e){var t=this;t.all=e.query()}function StoriesCreateController(e,t,r,o){function l(){e.save(n.story,function(e){t.go("storiesCreateEntry",{id:e._id})})}var n=this;n.authUser=r.getPayload(),n.authUser&&(n.authUser=n.authUser._id),o.get({id:n.authUser},function(e){n.userInfo=e}),n.story={userId:n.authUser},n.create=l}function StoriesCreateEntryController(e,t,r){function o(){l.story.entries.push(l.new),console.log(l.story.entries),l.story.$update(function(){t.go("storiesShow",t.params)})}var l=this;l.authUser=r.getPayload(),l.authUser&&(l.authUser=l.authUser._id),e.get(t.params,function(e){l.story=e,l.new={order:l.story.entries.length+1}}),l.addEntry=o}function StoriesShowController(e,t,r){function o(){l.story.$remove(function(){t.go("storiesIndex")})}var l=this;e.get(t.params,function(e){l.story=e,l.authUser=r.getPayload(),l.authUser&&(l.authUser=l.authUser._id),l.isLoggedIn=r.isAuthenticated,l.delete=o})}function StoriesEditController(e,t){function r(){console.log(o.entry)}var o=this;console.log("I am working"),e.get(t.params,function(e){o.entry=e}),o.update=r}function Story(e){return new e("/stories/:id",{id:"@_id"},{update:{method:"PUT"}})}function User(e){return new e("/users/:id",{id:"@_id"},{update:{method:"PUT"}})}function user(){var e=this;e.account={}}function UsersIndexController(e){var t=this;t.all=e.query()}function UsersNewController(e,t){function r(){e.save(o.user,function(){t.go("userIndex")})}var o=this;o.user={},o.create=r}function UsersShowController(e,t,r,o){function l(){var e=s.user.likes.indexOf(s.authUser);!s.user.likes.includes(s.authUser)&&s.authUser?s.user.likes.push(s.authUser):s.user.likes.includes(s.authUser)&&s.authUser&&s.user.likes.splice(e,1),s.user.$update()}function n(){s.user.$remove(function(){t.go("usersIndex")})}var s=this;e.get(t.params).$promise.then(function(e){s.user=e,s.authUser=r.getPayload(),s.authUser&&(s.authUser=s.authUser._id),console.log(s.user),s.video=o.trustAsHtml(s.user.video),s.incrementLikes=l,s.isLoggedIn=r.isAuthenticated,s.delete=n})}function UsersEditController(e,t,r,o){function l(){n.user.$update(function(e){t.go("usersShow",{id:n.authUser}),o.account=e})}var n=this;n.authUser=r.getPayload(),n.authUser&&(n.authUser=n.authUser._id),e.get({id:n.authUser}).$promise.then(function(e){n.user=e}),n.update=l}angular.module("goApp",["ngResource","ui.router","satellizer"]).config(Router).config(Auth),Router.$inject=["$stateProvider","$urlRouterProvider"],Auth.$inject=["$authProvider"],angular.module("goApp").controller("RegisterController",RegisterController).controller("ConfirmController",ConfirmController).controller("LoginController",LoginController),RegisterController.$inject=["$auth","$state"],ConfirmController.$inject=["$http","$state"],LoginController.$inject=["$auth","$state","User","user"],angular.module("goApp").factory("Challenge",Challenge),Challenge.$inject=["$resource"],angular.module("goApp").controller("ChallengesIndexController",ChallengesIndexController).controller("ChallengesNewController",ChallengesNewController).controller("ChallengesShowController",ChallengesShowController).controller("ChallengesEditController",ChallengesEditController),ChallengesIndexController.$inject=["Challenge"],ChallengesNewController.$inject=["Challenge","$state","$auth"],ChallengesShowController.$inject=["Challenge","User","$state","$auth"],ChallengesEditController.$inject=["Challenge","$state"],angular.module("goApp").service("currentUser",currentUser),currentUser.$inject=["User","$auth"],angular.module("goApp").factory("StoryEntries",StoryEntries),StoryEntries.$inject=["$resource"],angular.module("goApp").directive("googleMap",googleMap).directive("googleplace",googleplace),googleplace.$inject=["$window"],googleMap.$inject=["$window"],angular.module("goApp").controller("MainController",MainController),MainController.$inject=["$auth","$rootScope","$state"],angular.module("goApp").controller("ProfileController",ProfileController),ProfileController.$inject=["$auth","$state","User","user"],angular.module("goApp").controller("StoriesIndexController",StoriesIndexController).controller("StoriesCreateController",StoriesCreateController).controller("StoriesCreateEntryController",StoriesCreateEntryController).controller("StoriesShowController",StoriesShowController).controller("StoriesEditController",StoriesEditController),StoriesIndexController.$inject=["Story"],StoriesCreateController.$inject=["Story","$state","$auth","User"],StoriesCreateEntryController.$inject=["Story","$state","$auth"],StoriesShowController.$inject=["Story","$state","$auth"],StoriesEditController.$inject=["Story","$state"],angular.module("goApp").factory("Story",Story),Story.$inject=["$resource"],angular.module("goApp").factory("User",User),User.$inject=["$resource"],angular.module("goApp").service("user",user),angular.module("goApp").controller("UsersIndexController",UsersIndexController).controller("UsersNewController",UsersNewController).controller("UsersShowController",UsersShowController).controller("UsersEditController",UsersEditController),UsersIndexController.$inject=["User"],UsersNewController.$inject=["User","$state"],UsersShowController.$inject=["User","$state","$auth","$sce"],UsersEditController.$inject=["User","$state","$auth","user"];
//# sourceMappingURL=app.js.map
